5f645ae438f8540dfa51210364aa70cb
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var ErrorUtils=require('ErrorUtils');var Systrace=require('Systrace');var deepFreezeAndThrowOnMutationInDev=require('deepFreezeAndThrowOnMutationInDev');var invariant=require('fbjs/lib/invariant');var stringifySafe=require('stringifySafe');var TO_JS=0;var TO_NATIVE=1;var MODULE_IDS=0;var METHOD_IDS=1;var PARAMS=2;var MIN_TIME_BETWEEN_FLUSHES_MS=5;var TRACE_TAG_REACT_APPS=1<<17;var DEBUG_INFO_LIMIT=32;var JSTimers=null;var MessageQueue=function(){function MessageQueue(){var shouldUninstallGlobalErrorHandler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,MessageQueue);this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks=[];this._failureCallbacks=[];this._callID=0;this._lastFlush=0;this._eventLoopStartTime=new Date().getTime();if(shouldUninstallGlobalErrorHandler){this.uninstallGlobalErrorHandler();}else{this.installGlobalErrorHandler();}if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}this.callFunctionReturnFlushedQueue=this.callFunctionReturnFlushedQueue.bind(this);this.callFunctionReturnResultAndFlushedQueue=this.callFunctionReturnResultAndFlushedQueue.bind(this);this.flushedQueue=this.flushedQueue.bind(this);this.invokeCallbackAndReturnFlushedQueue=this.invokeCallbackAndReturnFlushedQueue.bind(this);}_createClass(MessageQueue,[{key:'callFunctionReturnFlushedQueue',value:function callFunctionReturnFlushedQueue(module,method,args){var _this=this;this.__guard(function(){_this.__callFunction(module,method,args);});return this.flushedQueue();}},{key:'callFunctionReturnResultAndFlushedQueue',value:function callFunctionReturnResultAndFlushedQueue(module,method,args){var _this2=this;var result=void 0;this.__guard(function(){result=_this2.__callFunction(module,method,args);});return[result,this.flushedQueue()];}},{key:'invokeCallbackAndReturnFlushedQueue',value:function invokeCallbackAndReturnFlushedQueue(cbID,args){var _this3=this;this.__guard(function(){_this3.__invokeCallback(cbID,args);});return this.flushedQueue();}},{key:'flushedQueue',value:function flushedQueue(){var _this4=this;this.__guard(function(){_this4.__callImmediates();});var queue=this._queue;this._queue=[[],[],[],this._callID];return queue[0].length?queue:null;}},{key:'getEventLoopRunningTime',value:function getEventLoopRunningTime(){return new Date().getTime()-this._eventLoopStartTime;}},{key:'registerCallableModule',value:function registerCallableModule(name,module){this._lazyCallableModules[name]=function(){return module;};}},{key:'registerLazyCallableModule',value:function registerLazyCallableModule(name,factory){var module=void 0;var getValue=factory;this._lazyCallableModules[name]=function(){if(getValue){module=getValue();getValue=null;}return module;};}},{key:'getCallableModule',value:function getCallableModule(name){var getValue=this._lazyCallableModules[name];return getValue?getValue():null;}},{key:'enqueueNativeCall',value:function enqueueNativeCall(moduleID,methodID,params,onFail,onSucc){if(onFail||onSucc){if(__DEV__){this._debugInfo[this._callID]=[moduleID,methodID];if(this._callID>DEBUG_INFO_LIMIT){delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];}}onFail&&params.push(this._callID<<1);onSucc&&params.push(this._callID<<1|1);this._successCallbacks[this._callID]=onSucc;this._failureCallbacks[this._callID]=onFail;}if(__DEV__){global.nativeTraceBeginAsyncFlow&&global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS,'native',this._callID);}this._callID++;this._queue[MODULE_IDS].push(moduleID);this._queue[METHOD_IDS].push(methodID);if(__DEV__){var isValidArgument=function isValidArgument(val){var t=typeof val;if(t==='undefined'||t==='null'||t==='boolean'||t==='number'||t==='string'){return true;}if(t==='function'||t!=='object'){return false;}if(Array.isArray(val)){return val.every(isValidArgument);}for(var k in val){if(typeof val[k]!=='function'&&!isValidArgument(val[k])){return false;}}return true;};invariant(isValidArgument(params),'%s is not usable as a native method argument',params);deepFreezeAndThrowOnMutationInDev(params);}this._queue[PARAMS].push(params);var now=new Date().getTime();if(global.nativeFlushQueueImmediate&&(now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS||this._inCall===0)){var queue=this._queue;this._queue=[[],[],[],this._callID];this._lastFlush=now;global.nativeFlushQueueImmediate(queue);}Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);if(__DEV__&&this.__spy&&isFinite(moduleID)){this.__spy({type:TO_NATIVE,module:this._remoteModuleTable[moduleID],method:this._remoteMethodTable[moduleID][methodID],args:params});}else if(this.__spy){this.__spy({type:TO_NATIVE,module:moduleID+'',method:methodID,args:params});}}},{key:'createDebugLookup',value:function createDebugLookup(moduleID,name,methods){if(__DEV__){this._remoteModuleTable[moduleID]=name;this._remoteMethodTable[moduleID]=methods;}}},{key:'uninstallGlobalErrorHandler',value:function uninstallGlobalErrorHandler(){this.__guard=this.__guardUnsafe;}},{key:'installGlobalErrorHandler',value:function installGlobalErrorHandler(){this.__guard=this.__guardSafe;}},{key:'__guardUnsafe',value:function __guardUnsafe(fn){this._inCall++;fn();this._inCall--;}},{key:'__guardSafe',value:function __guardSafe(fn){this._inCall++;try{fn();}catch(error){ErrorUtils.reportFatalError(error);}finally{this._inCall--;}}},{key:'__callImmediates',value:function __callImmediates(){Systrace.beginEvent('JSTimers.callImmediates()');if(!JSTimers){JSTimers=require('JSTimers');}JSTimers.callImmediates();Systrace.endEvent();}},{key:'__callFunction',value:function __callFunction(module,method,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;Systrace.beginEvent(module+'.'+method+'()');if(this.__spy){this.__spy({type:TO_JS,module:module,method:method,args:args});}var moduleMethods=this.getCallableModule(module);invariant(!!moduleMethods,'Module %s is not a registered callable module (calling %s)',module,method);invariant(!!moduleMethods[method],'Method %s does not exist on module %s',method,module);var result=moduleMethods[method].apply(moduleMethods,args);Systrace.endEvent();return result;}},{key:'__invokeCallback',value:function __invokeCallback(cbID,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;var callID=cbID>>>1;var isSuccess=cbID&1;var callback=isSuccess?this._successCallbacks[callID]:this._failureCallbacks[callID];if(__DEV__){var debug=this._debugInfo[callID];var _module=debug&&this._remoteModuleTable[debug[0]];var _method=debug&&this._remoteMethodTable[debug[0]][debug[1]];if(!callback){var errorMessage='Callback with id '+cbID+': '+_module+'.'+_method+'() not found';if(_method){errorMessage='The callback '+_method+'() exists in module '+_module+', '+'but only one callback may be registered to a function in a native module.';}invariant(callback,errorMessage);}var profileName=debug?'<callback for '+_module+'.'+_method+'>':cbID;if(callback&&this.__spy){this.__spy({type:TO_JS,module:null,method:profileName,args:args});}Systrace.beginEvent('MessageQueue.invokeCallback('+profileName+', '+stringifySafe(args)+')');}if(!callback){return;}this._successCallbacks[callID]=this._failureCallbacks[callID]=null;callback.apply(undefined,_toConsumableArray(args));if(__DEV__){Systrace.endEvent();}}}],[{key:'spy',value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+' : '+(''+(info.module?info.module+'.':'')+info.method)+('('+JSON.stringify(info.args)+')'));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();module.exports=MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VRdWV1ZS5qcyJdLCJuYW1lcyI6WyJFcnJvclV0aWxzIiwicmVxdWlyZSIsIlN5c3RyYWNlIiwiZGVlcEZyZWV6ZUFuZFRocm93T25NdXRhdGlvbkluRGV2IiwiaW52YXJpYW50Iiwic3RyaW5naWZ5U2FmZSIsIlRPX0pTIiwiVE9fTkFUSVZFIiwiTU9EVUxFX0lEUyIsIk1FVEhPRF9JRFMiLCJQQVJBTVMiLCJNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIkRFQlVHX0lORk9fTElNSVQiLCJKU1RpbWVycyIsIk1lc3NhZ2VRdWV1ZSIsInNob3VsZFVuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlciIsIl9sYXp5Q2FsbGFibGVNb2R1bGVzIiwiX3F1ZXVlIiwiX3N1Y2Nlc3NDYWxsYmFja3MiLCJfZmFpbHVyZUNhbGxiYWNrcyIsIl9jYWxsSUQiLCJfbGFzdEZsdXNoIiwiX2V2ZW50TG9vcFN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwidW5pbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyIiwiaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlciIsIl9fREVWX18iLCJfZGVidWdJbmZvIiwiX3JlbW90ZU1vZHVsZVRhYmxlIiwiX3JlbW90ZU1ldGhvZFRhYmxlIiwiY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlIiwiYmluZCIsImNhbGxGdW5jdGlvblJldHVyblJlc3VsdEFuZEZsdXNoZWRRdWV1ZSIsImZsdXNoZWRRdWV1ZSIsImludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlIiwibW9kdWxlIiwibWV0aG9kIiwiYXJncyIsIl9fZ3VhcmQiLCJfX2NhbGxGdW5jdGlvbiIsInJlc3VsdCIsImNiSUQiLCJfX2ludm9rZUNhbGxiYWNrIiwiX19jYWxsSW1tZWRpYXRlcyIsInF1ZXVlIiwibGVuZ3RoIiwibmFtZSIsImZhY3RvcnkiLCJnZXRWYWx1ZSIsIm1vZHVsZUlEIiwibWV0aG9kSUQiLCJwYXJhbXMiLCJvbkZhaWwiLCJvblN1Y2MiLCJwdXNoIiwiZ2xvYmFsIiwibmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyIsImlzVmFsaWRBcmd1bWVudCIsInQiLCJ2YWwiLCJBcnJheSIsImlzQXJyYXkiLCJldmVyeSIsImsiLCJub3ciLCJuYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlIiwiX2luQ2FsbCIsImNvdW50ZXJFdmVudCIsIl9fc3B5IiwiaXNGaW5pdGUiLCJ0eXBlIiwibWV0aG9kcyIsIl9fZ3VhcmRVbnNhZmUiLCJfX2d1YXJkU2FmZSIsImZuIiwiZXJyb3IiLCJyZXBvcnRGYXRhbEVycm9yIiwiYmVnaW5FdmVudCIsImNhbGxJbW1lZGlhdGVzIiwiZW5kRXZlbnQiLCJtb2R1bGVNZXRob2RzIiwiZ2V0Q2FsbGFibGVNb2R1bGUiLCJhcHBseSIsImNhbGxJRCIsImlzU3VjY2VzcyIsImNhbGxiYWNrIiwiZGVidWciLCJlcnJvck1lc3NhZ2UiLCJwcm9maWxlTmFtZSIsInNweU9yVG9nZ2xlIiwicHJvdG90eXBlIiwiY29uc29sZSIsImxvZyIsImluZm8iLCJKU09OIiwic3RyaW5naWZ5IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBYUEsYSx1ekJBRUEsR0FBTUEsWUFBYUMsT0FBYixjQUFOLENBQ0EsR0FBTUMsVUFBV0QsT0FBWCxZQUFOLENBRUEsR0FBTUUsbUNBQW9DRixPQUFwQyxxQ0FBTixDQUNBLEdBQU1HLFdBQVlILE9BQVosc0JBQU4sQ0FDQSxHQUFNSSxlQUFnQkosT0FBaEIsaUJBQU4sQ0FTQSxHQUFNSyxPQUFRLENBQWQsQ0FDQSxHQUFNQyxXQUFZLENBQWxCLENBRUEsR0FBTUMsWUFBYSxDQUFuQixDQUNBLEdBQU1DLFlBQWEsQ0FBbkIsQ0FDQSxHQUFNQyxRQUFTLENBQWYsQ0FDQSxHQUFNQyw2QkFBOEIsQ0FBcEMsQ0FHQSxHQUFNQyxzQkFBdUIsR0FBSyxFQUFsQyxDQUVBLEdBQU1DLGtCQUFtQixFQUF6QixDQUdBLEdBQUlDLFVBQVcsSUFBZixDLEdBRU1D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a0MsSUFBZCxDQURqRCxNQUdELENBRUQsR0FBSSxDQUFDZ0QsUUFBTCxDQUFlLENBQ2IsT0FDRCxDQUVELEtBQUtwRSxpQkFBTCxDQUF1QmtFLE1BQXZCLEVBQWlDLEtBQUtqRSxpQkFBTCxDQUF1QmlFLE1BQXZCLEVBQWlDLElBQWxFLENBQ0FFLDRDQUFZaEQsSUFBWixHQUVBLEdBQUlYLE9BQUosQ0FBYSxDQUNYMUIsU0FBUytFLFFBQVQsR0FDRCxDQUNGLEMsa0NBalRVVSxXLENBQWtELENBQzNELEdBQUlBLGNBQWdCLElBQXBCLENBQTBCLENBQ3hCNUUsYUFBYTZFLFNBQWIsQ0FBdUJ0QixLQUF2QixDQUErQixjQUFRLENBQ3JDdUIsUUFBUUMsR0FBUixDQUNFLENBQUdDLEtBQUt2QixJQUFMLEdBQWNsRSxLQUFkLENBQXNCLE9BQXRCLENBQWdDLE9BQW5DLGFBQ0t5RixLQUFLMUQsTUFBTCxDQUFjMEQsS0FBSzFELE1BQUwsQ0FBYyxHQUE1QixDQUFrQyxFQUR2QyxFQUM0QzBELEtBQUt6RCxNQURqRCxPQUVNMEQsS0FBS0MsU0FBTCxDQUFlRixLQUFLeEQsSUFBcEIsQ0FGTixLQURGLEVBS0QsQ0FORCxDQU9ELENBUkQsSUFRTyxJQUFJb0QsY0FBZ0IsS0FBcEIsQ0FBMkIsQ0FDaEM1RSxhQUFhNkUsU0FBYixDQUF1QnRCLEtBQXZCLENBQStCLElBQS9CLENBQ0QsQ0FGTSxJQUVBLENBQ0x2RCxhQUFhNkUsU0FBYixDQUF1QnRCLEtBQXZCLENBQStCcUIsV0FBL0IsQ0FDRCxDQUNGLEMsNEJBc1NIdEQsT0FBTzZELE9BQVAsQ0FBaUJuRixZQUFqQiIsImZpbGUiOiJNZXNzYWdlUXVldWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIE1lc3NhZ2VRdWV1ZVxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVycm9yVXRpbHMgPSByZXF1aXJlKCdFcnJvclV0aWxzJyk7XG5jb25zdCBTeXN0cmFjZSA9IHJlcXVpcmUoJ1N5c3RyYWNlJyk7XG5cbmNvbnN0IGRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldiA9IHJlcXVpcmUoJ2RlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldicpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCBzdHJpbmdpZnlTYWZlID0gcmVxdWlyZSgnc3RyaW5naWZ5U2FmZScpO1xuXG5leHBvcnQgdHlwZSBTcHlEYXRhID0ge1xuICB0eXBlOiBudW1iZXIsXG4gIG1vZHVsZTogP3N0cmluZyxcbiAgbWV0aG9kOiBzdHJpbmcgfCBudW1iZXIsXG4gIGFyZ3M6IGFueVtdLFxufTtcblxuY29uc3QgVE9fSlMgPSAwO1xuY29uc3QgVE9fTkFUSVZFID0gMTtcblxuY29uc3QgTU9EVUxFX0lEUyA9IDA7XG5jb25zdCBNRVRIT0RfSURTID0gMTtcbmNvbnN0IFBBUkFNUyA9IDI7XG5jb25zdCBNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMgPSA1O1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuY29uc3QgVFJBQ0VfVEFHX1JFQUNUX0FQUFMgPSAxIDw8IDE3O1xuXG5jb25zdCBERUJVR19JTkZPX0xJTUlUID0gMzI7XG5cbi8vIFdvcmsgYXJvdW5kIGFuIGluaXRpYWxpemF0aW9uIG9yZGVyIGlzc3VlXG5sZXQgSlNUaW1lcnMgPSBudWxsO1xuXG5jbGFzcyBNZXNzYWdlUXVldWUge1xuICBfbGF6eUNhbGxhYmxlTW9kdWxlczoge1trZXk6IHN0cmluZ106ICh2b2lkKSA9PiBPYmplY3R9O1xuICBfcXVldWU6IFtudW1iZXJbXSwgbnVtYmVyW10sIGFueVtdLCBudW1iZXJdO1xuICBfc3VjY2Vzc0NhbGxiYWNrczogKD9GdW5jdGlvbilbXTtcbiAgX2ZhaWx1cmVDYWxsYmFja3M6ICg/RnVuY3Rpb24pW107XG4gIF9jYWxsSUQ6IG51bWJlcjtcbiAgX2luQ2FsbDogbnVtYmVyO1xuICBfbGFzdEZsdXNoOiBudW1iZXI7XG4gIF9ldmVudExvb3BTdGFydFRpbWU6IG51bWJlcjtcblxuICBfZGVidWdJbmZvOiB7W251bWJlcl06IFtudW1iZXIsIG51bWJlcl19O1xuICBfcmVtb3RlTW9kdWxlVGFibGU6IHtbbnVtYmVyXTogc3RyaW5nfTtcbiAgX3JlbW90ZU1ldGhvZFRhYmxlOiB7W251bWJlcl06IHN0cmluZ1tdfTtcblxuICBfX3NweTogPyhkYXRhOiBTcHlEYXRhKSA9PiB2b2lkO1xuXG4gIF9fZ3VhcmQ6ICgoKSA9PiB2b2lkKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKHNob3VsZFVuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlcjogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlcyA9IHt9O1xuICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIDBdO1xuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3MgPSBbXTtcbiAgICB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzID0gW107XG4gICAgdGhpcy5fY2FsbElEID0gMDtcbiAgICB0aGlzLl9sYXN0Rmx1c2ggPSAwO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGlmIChzaG91bGRVbmluc3RhbGxHbG9iYWxFcnJvckhhbmRsZXIpIHtcbiAgICAgIHRoaXMudW5pbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5zdGFsbEdsb2JhbEVycm9ySGFuZGxlcigpO1xuICAgIH1cblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICB0aGlzLl9kZWJ1Z0luZm8gPSB7fTtcbiAgICAgIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZSA9IHt9O1xuICAgIH1cblxuICAgICh0aGlzOiBhbnkpLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZSA9IHRoaXMuY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlLmJpbmQoXG4gICAgICB0aGlzLFxuICAgICk7XG4gICAgKHRoaXM6IGFueSkuY2FsbEZ1bmN0aW9uUmV0dXJuUmVzdWx0QW5kRmx1c2hlZFF1ZXVlID0gdGhpcy5jYWxsRnVuY3Rpb25SZXR1cm5SZXN1bHRBbmRGbHVzaGVkUXVldWUuYmluZChcbiAgICAgIHRoaXMsXG4gICAgKTtcbiAgICAodGhpczogYW55KS5mbHVzaGVkUXVldWUgPSB0aGlzLmZsdXNoZWRRdWV1ZS5iaW5kKHRoaXMpO1xuICAgICh0aGlzOiBhbnkpLmludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlID0gdGhpcy5pbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZS5iaW5kKFxuICAgICAgdGhpcyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBBUElzXG4gICAqL1xuXG4gIHN0YXRpYyBzcHkoc3B5T3JUb2dnbGU6IGJvb2xlYW4gfCAoKGRhdGE6IFNweURhdGEpID0+IHZvaWQpKSB7XG4gICAgaWYgKHNweU9yVG9nZ2xlID09PSB0cnVlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gaW5mbyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGAke2luZm8udHlwZSA9PT0gVE9fSlMgPyAnTi0+SlMnIDogJ0pTLT5OJ30gOiBgICtcbiAgICAgICAgICAgIGAke2luZm8ubW9kdWxlID8gaW5mby5tb2R1bGUgKyAnLicgOiAnJ30ke2luZm8ubWV0aG9kfWAgK1xuICAgICAgICAgICAgYCgke0pTT04uc3RyaW5naWZ5KGluZm8uYXJncyl9KWAsXG4gICAgICAgICk7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoc3B5T3JUb2dnbGUgPT09IGZhbHNlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IHNweU9yVG9nZ2xlO1xuICAgIH1cbiAgfVxuXG4gIGNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZShtb2R1bGU6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIGFyZ3M6IGFueVtdKSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsRnVuY3Rpb24obW9kdWxlLCBtZXRob2QsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZmx1c2hlZFF1ZXVlKCk7XG4gIH1cblxuICBjYWxsRnVuY3Rpb25SZXR1cm5SZXN1bHRBbmRGbHVzaGVkUXVldWUoXG4gICAgbW9kdWxlOiBzdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgYXJnczogYW55W10sXG4gICkge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHJlc3VsdCA9IHRoaXMuX19jYWxsRnVuY3Rpb24obW9kdWxlLCBtZXRob2QsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIFtyZXN1bHQsIHRoaXMuZmx1c2hlZFF1ZXVlKCldO1xuICB9XG5cbiAgaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUoY2JJRDogbnVtYmVyLCBhcmdzOiBhbnlbXSkge1xuICAgIHRoaXMuX19ndWFyZCgoKSA9PiB7XG4gICAgICB0aGlzLl9faW52b2tlQ2FsbGJhY2soY2JJRCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5mbHVzaGVkUXVldWUoKTtcbiAgfVxuXG4gIGZsdXNoZWRRdWV1ZSgpIHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2NhbGxJbW1lZGlhdGVzKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIHRoaXMuX2NhbGxJRF07XG4gICAgcmV0dXJuIHF1ZXVlWzBdLmxlbmd0aCA/IHF1ZXVlIDogbnVsbDtcbiAgfVxuXG4gIGdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lKCkge1xuICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZTtcbiAgfVxuXG4gIHJlZ2lzdGVyQ2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nLCBtb2R1bGU6IE9iamVjdCkge1xuICAgIHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXNbbmFtZV0gPSAoKSA9PiBtb2R1bGU7XG4gIH1cblxuICByZWdpc3RlckxhenlDYWxsYWJsZU1vZHVsZShuYW1lOiBzdHJpbmcsIGZhY3Rvcnk6IHZvaWQgPT4gT2JqZWN0KSB7XG4gICAgbGV0IG1vZHVsZTogT2JqZWN0O1xuICAgIGxldCBnZXRWYWx1ZTogPyh2b2lkKSA9PiBPYmplY3QgPSBmYWN0b3J5O1xuICAgIHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXNbbmFtZV0gPSAoKSA9PiB7XG4gICAgICBpZiAoZ2V0VmFsdWUpIHtcbiAgICAgICAgbW9kdWxlID0gZ2V0VmFsdWUoKTtcbiAgICAgICAgZ2V0VmFsdWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1vZHVsZTtcbiAgICB9O1xuICB9XG5cbiAgZ2V0Q2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgZ2V0VmFsdWUgPSB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdO1xuICAgIHJldHVybiBnZXRWYWx1ZSA/IGdldFZhbHVlKCkgOiBudWxsO1xuICB9XG5cbiAgZW5xdWV1ZU5hdGl2ZUNhbGwoXG4gICAgbW9kdWxlSUQ6IG51bWJlcixcbiAgICBtZXRob2RJRDogbnVtYmVyLFxuICAgIHBhcmFtczogYW55W10sXG4gICAgb25GYWlsOiA/RnVuY3Rpb24sXG4gICAgb25TdWNjOiA/RnVuY3Rpb24sXG4gICkge1xuICAgIGlmIChvbkZhaWwgfHwgb25TdWNjKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEXSA9IFttb2R1bGVJRCwgbWV0aG9kSURdO1xuICAgICAgICBpZiAodGhpcy5fY2FsbElEID4gREVCVUdfSU5GT19MSU1JVCkge1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEIC0gREVCVUdfSU5GT19MSU1JVF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEVuY29kZSBjYWxsSURzIGludG8gcGFpcnMgb2YgY2FsbGJhY2sgaWRlbnRpZmllcnMgYnkgc2hpZnRpbmcgbGVmdCBhbmQgdXNpbmcgdGhlIHJpZ2h0bW9zdCBiaXRcbiAgICAgIC8vIHRvIGluZGljYXRlIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgICAgb25GYWlsICYmIHBhcmFtcy5wdXNoKHRoaXMuX2NhbGxJRCA8PCAxKTtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgICBvblN1Y2MgJiYgcGFyYW1zLnB1c2goKHRoaXMuX2NhbGxJRCA8PCAxKSB8IDEpO1xuICAgICAgdGhpcy5fc3VjY2Vzc0NhbGxiYWNrc1t0aGlzLl9jYWxsSURdID0gb25TdWNjO1xuICAgICAgdGhpcy5fZmFpbHVyZUNhbGxiYWNrc1t0aGlzLl9jYWxsSURdID0gb25GYWlsO1xuICAgIH1cblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyAmJlxuICAgICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyhcbiAgICAgICAgICBUUkFDRV9UQUdfUkVBQ1RfQVBQUyxcbiAgICAgICAgICAnbmF0aXZlJyxcbiAgICAgICAgICB0aGlzLl9jYWxsSUQsXG4gICAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX2NhbGxJRCsrO1xuXG4gICAgdGhpcy5fcXVldWVbTU9EVUxFX0lEU10ucHVzaChtb2R1bGVJRCk7XG4gICAgdGhpcy5fcXVldWVbTUVUSE9EX0lEU10ucHVzaChtZXRob2RJRCk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgLy8gVmFsaWRhdGUgdGhhdCBwYXJhbWV0ZXJzIHBhc3NlZCBvdmVyIHRoZSBicmlkZ2UgYXJlXG4gICAgICAvLyBmb2xseS1jb252ZXJ0aWJsZS4gIEFzIGEgc3BlY2lhbCBjYXNlLCBpZiBhIHByb3AgdmFsdWUgaXMgYVxuICAgICAgLy8gZnVuY3Rpb24gaXQgaXMgcGVybWl0dGVkIGhlcmUsIGFuZCBzcGVjaWFsLWNhc2VkIGluIHRoZVxuICAgICAgLy8gY29udmVyc2lvbi5cbiAgICAgIGNvbnN0IGlzVmFsaWRBcmd1bWVudCA9IHZhbCA9PiB7XG4gICAgICAgIGNvbnN0IHQgPSB0eXBlb2YgdmFsO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdCA9PT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgICAgICB0ID09PSAnbnVsbCcgfHxcbiAgICAgICAgICB0ID09PSAnYm9vbGVhbicgfHxcbiAgICAgICAgICB0ID09PSAnbnVtYmVyJyB8fFxuICAgICAgICAgIHQgPT09ICdzdHJpbmcnXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ID09PSAnZnVuY3Rpb24nIHx8IHQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICAgICAgICByZXR1cm4gdmFsLmV2ZXJ5KGlzVmFsaWRBcmd1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBrIGluIHZhbCkge1xuICAgICAgICAgIGlmICh0eXBlb2YgdmFsW2tdICE9PSAnZnVuY3Rpb24nICYmICFpc1ZhbGlkQXJndW1lbnQodmFsW2tdKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIGludmFyaWFudChcbiAgICAgICAgaXNWYWxpZEFyZ3VtZW50KHBhcmFtcyksXG4gICAgICAgICclcyBpcyBub3QgdXNhYmxlIGFzIGEgbmF0aXZlIG1ldGhvZCBhcmd1bWVudCcsXG4gICAgICAgIHBhcmFtcyxcbiAgICAgICk7XG5cbiAgICAgIC8vIFRoZSBwYXJhbXMgb2JqZWN0IHNob3VsZCBub3QgYmUgbXV0YXRlZCBhZnRlciBiZWluZyBxdWV1ZWRcbiAgICAgIGRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldigocGFyYW1zOiBhbnkpKTtcbiAgICB9XG4gICAgdGhpcy5fcXVldWVbUEFSQU1TXS5wdXNoKHBhcmFtcyk7XG5cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBpZiAoXG4gICAgICBnbG9iYWwubmF0aXZlRmx1c2hRdWV1ZUltbWVkaWF0ZSAmJlxuICAgICAgKG5vdyAtIHRoaXMuX2xhc3RGbHVzaCA+PSBNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMgfHxcbiAgICAgICAgdGhpcy5faW5DYWxsID09PSAwKVxuICAgICkge1xuICAgICAgdmFyIHF1ZXVlID0gdGhpcy5fcXVldWU7XG4gICAgICB0aGlzLl9xdWV1ZSA9IFtbXSwgW10sIFtdLCB0aGlzLl9jYWxsSURdO1xuICAgICAgdGhpcy5fbGFzdEZsdXNoID0gbm93O1xuICAgICAgZ2xvYmFsLm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUocXVldWUpO1xuICAgIH1cbiAgICBTeXN0cmFjZS5jb3VudGVyRXZlbnQoJ3BlbmRpbmdfanNfdG9fbmF0aXZlX3F1ZXVlJywgdGhpcy5fcXVldWVbMF0ubGVuZ3RoKTtcbiAgICBpZiAoX19ERVZfXyAmJiB0aGlzLl9fc3B5ICYmIGlzRmluaXRlKG1vZHVsZUlEKSkge1xuICAgICAgdGhpcy5fX3NweSh7XG4gICAgICAgIHR5cGU6IFRPX05BVElWRSxcbiAgICAgICAgbW9kdWxlOiB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZVttb2R1bGVJRF0sXG4gICAgICAgIG1ldGhvZDogdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbbW9kdWxlSURdW21ldGhvZElEXSxcbiAgICAgICAgYXJnczogcGFyYW1zLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5KHtcbiAgICAgICAgdHlwZTogVE9fTkFUSVZFLFxuICAgICAgICBtb2R1bGU6IG1vZHVsZUlEICsgJycsXG4gICAgICAgIG1ldGhvZDogbWV0aG9kSUQsXG4gICAgICAgIGFyZ3M6IHBhcmFtcyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZURlYnVnTG9va3VwKG1vZHVsZUlEOiBudW1iZXIsIG5hbWU6IHN0cmluZywgbWV0aG9kczogc3RyaW5nW10pIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdID0gbmFtZTtcbiAgICAgIHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXSA9IG1ldGhvZHM7XG4gICAgfVxuICB9XG5cbiAgdW5pbnN0YWxsR2xvYmFsRXJyb3JIYW5kbGVyKCkge1xuICAgIHRoaXMuX19ndWFyZCA9IHRoaXMuX19ndWFyZFVuc2FmZTtcbiAgfVxuXG4gIGluc3RhbGxHbG9iYWxFcnJvckhhbmRsZXIoKSB7XG4gICAgdGhpcy5fX2d1YXJkID0gdGhpcy5fX2d1YXJkU2FmZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1ldGhvZHNcbiAgICovXG5cbiAgLy8gTGV0cyBleGNlcHRpb25zIHByb3BhZ2F0ZSB0byBiZSBoYW5kbGVkIGJ5IHRoZSBWTSBhdCB0aGUgb3JpZ2luXG4gIF9fZ3VhcmRVbnNhZmUoZm46ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9pbkNhbGwrKztcbiAgICBmbigpO1xuICAgIHRoaXMuX2luQ2FsbC0tO1xuICB9XG5cbiAgX19ndWFyZFNhZmUoZm46ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9pbkNhbGwrKztcbiAgICB0cnkge1xuICAgICAgZm4oKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JVdGlscy5yZXBvcnRGYXRhbEVycm9yKGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5faW5DYWxsLS07XG4gICAgfVxuICB9XG5cbiAgX19jYWxsSW1tZWRpYXRlcygpIHtcbiAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KCdKU1RpbWVycy5jYWxsSW1tZWRpYXRlcygpJyk7XG4gICAgaWYgKCFKU1RpbWVycykge1xuICAgICAgSlNUaW1lcnMgPSByZXF1aXJlKCdKU1RpbWVycycpO1xuICAgIH1cbiAgICBKU1RpbWVycy5jYWxsSW1tZWRpYXRlcygpO1xuICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gIH1cblxuICBfX2NhbGxGdW5jdGlvbihtb2R1bGU6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIGFyZ3M6IGFueVtdKTogYW55IHtcbiAgICB0aGlzLl9sYXN0Rmx1c2ggPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB0aGlzLl9ldmVudExvb3BTdGFydFRpbWUgPSB0aGlzLl9sYXN0Rmx1c2g7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudChgJHttb2R1bGV9LiR7bWV0aG9kfSgpYCk7XG4gICAgaWYgKHRoaXMuX19zcHkpIHtcbiAgICAgIHRoaXMuX19zcHkoe3R5cGU6IFRPX0pTLCBtb2R1bGUsIG1ldGhvZCwgYXJnc30pO1xuICAgIH1cbiAgICBjb25zdCBtb2R1bGVNZXRob2RzID0gdGhpcy5nZXRDYWxsYWJsZU1vZHVsZShtb2R1bGUpO1xuICAgIGludmFyaWFudChcbiAgICAgICEhbW9kdWxlTWV0aG9kcyxcbiAgICAgICdNb2R1bGUgJXMgaXMgbm90IGEgcmVnaXN0ZXJlZCBjYWxsYWJsZSBtb2R1bGUgKGNhbGxpbmcgJXMpJyxcbiAgICAgIG1vZHVsZSxcbiAgICAgIG1ldGhvZCxcbiAgICApO1xuICAgIGludmFyaWFudChcbiAgICAgICEhbW9kdWxlTWV0aG9kc1ttZXRob2RdLFxuICAgICAgJ01ldGhvZCAlcyBkb2VzIG5vdCBleGlzdCBvbiBtb2R1bGUgJXMnLFxuICAgICAgbWV0aG9kLFxuICAgICAgbW9kdWxlLFxuICAgICk7XG4gICAgY29uc3QgcmVzdWx0ID0gbW9kdWxlTWV0aG9kc1ttZXRob2RdLmFwcGx5KG1vZHVsZU1ldGhvZHMsIGFyZ3MpO1xuICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIF9faW52b2tlQ2FsbGJhY2soY2JJRDogbnVtYmVyLCBhcmdzOiBhbnlbXSkge1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IHRoaXMuX2xhc3RGbHVzaDtcblxuICAgIC8vIFRoZSByaWdodG1vc3QgYml0IG9mIGNiSUQgaW5kaWNhdGVzIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpLCB0aGUgb3RoZXIgYml0cyBhcmUgdGhlIGNhbGxJRCBzaGlmdGVkIGxlZnQuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICBjb25zdCBjYWxsSUQgPSBjYklEID4+PiAxO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgY29uc3QgaXNTdWNjZXNzID0gY2JJRCAmIDE7XG4gICAgY29uc3QgY2FsbGJhY2sgPSBpc1N1Y2Nlc3NcbiAgICAgID8gdGhpcy5fc3VjY2Vzc0NhbGxiYWNrc1tjYWxsSURdXG4gICAgICA6IHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbY2FsbElEXTtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBjb25zdCBkZWJ1ZyA9IHRoaXMuX2RlYnVnSW5mb1tjYWxsSURdO1xuICAgICAgY29uc3QgbW9kdWxlID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbZGVidWdbMF1dO1xuICAgICAgY29uc3QgbWV0aG9kID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbZGVidWdbMF1dW2RlYnVnWzFdXTtcbiAgICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IGBDYWxsYmFjayB3aXRoIGlkICR7Y2JJRH06ICR7bW9kdWxlfS4ke21ldGhvZH0oKSBub3QgZm91bmRgO1xuICAgICAgICBpZiAobWV0aG9kKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICAgIGBUaGUgY2FsbGJhY2sgJHttZXRob2R9KCkgZXhpc3RzIGluIG1vZHVsZSAke21vZHVsZX0sIGAgK1xuICAgICAgICAgICAgJ2J1dCBvbmx5IG9uZSBjYWxsYmFjayBtYXkgYmUgcmVnaXN0ZXJlZCB0byBhIGZ1bmN0aW9uIGluIGEgbmF0aXZlIG1vZHVsZS4nO1xuICAgICAgICB9XG4gICAgICAgIGludmFyaWFudChjYWxsYmFjaywgZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByb2ZpbGVOYW1lID0gZGVidWdcbiAgICAgICAgPyAnPGNhbGxiYWNrIGZvciAnICsgbW9kdWxlICsgJy4nICsgbWV0aG9kICsgJz4nXG4gICAgICAgIDogY2JJRDtcbiAgICAgIGlmIChjYWxsYmFjayAmJiB0aGlzLl9fc3B5KSB7XG4gICAgICAgIHRoaXMuX19zcHkoe3R5cGU6IFRPX0pTLCBtb2R1bGU6IG51bGwsIG1ldGhvZDogcHJvZmlsZU5hbWUsIGFyZ3N9KTtcbiAgICAgIH1cbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoXG4gICAgICAgIGBNZXNzYWdlUXVldWUuaW52b2tlQ2FsbGJhY2soJHtwcm9maWxlTmFtZX0sICR7c3RyaW5naWZ5U2FmZShhcmdzKX0pYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbY2FsbElEXSA9IHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbY2FsbElEXSA9IG51bGw7XG4gICAgY2FsbGJhY2soLi4uYXJncyk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBNZXNzYWdlUXVldWU7XG4iXX0=