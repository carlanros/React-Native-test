e576fea8a9fad6092e96ec10982e87e8
Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof(typeof Symbol==="function"?Symbol.iterator:"@@iterator")==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==(typeof Symbol==="function"?Symbol.prototype:"@@prototype")?"symbol":typeof obj;};exports.buildPredicate=buildPredicate;exports.reduceTreeBySelector=reduceTreeBySelector;exports.reduceTreesBySelector=reduceTreesBySelector;var _rstSelectorParser=require("rst-selector-parser");var _object=require("object.values");var _object2=_interopRequireDefault(_object);var _isEmpty=require("lodash/isEmpty");var _isEmpty2=_interopRequireDefault(_isEmpty);var _flatten=require("lodash/flatten");var _flatten2=_interopRequireDefault(_flatten);var _uniq=require("lodash/uniq");var _uniq2=_interopRequireDefault(_uniq);var _objectIs=require("object-is");var _objectIs2=_interopRequireDefault(_objectIs);var _has=require("has");var _has2=_interopRequireDefault(_has);var _RSTTraversal=require('./RSTTraversal');var _Utils=require('./Utils');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}var parser=(0,_rstSelectorParser.createParser)();var CHILD='childCombinator';var ADJACENT_SIBLING='adjacentSiblingCombinator';var GENERAL_SIBLING='generalSiblingCombinator';var DESCENDANT='descendantCombinator';var SELECTOR='selector';var TYPE_SELECTOR='typeSelector';var CLASS_SELECTOR='classSelector';var ID_SELECTOR='idSelector';var ATTRIBUTE_PRESENCE='attributePresenceSelector';var ATTRIBUTE_VALUE='attributeValueSelector';var PSEUDO_CLASS='pseudoClassSelector';var PSEUDO_ELEMENT='pseudoElementSelector';var EXACT_ATTRIBUTE_OPERATOR='=';var WHITELIST_ATTRIBUTE_OPERATOR='~=';var HYPHENATED_ATTRIBUTE_OPERATOR='|=';var PREFIX_ATTRIBUTE_OPERATOR='^=';var SUFFIX_ATTRIBUTE_OPERATOR='$=';var SUBSTRING_ATTRIBUTE_OPERATOR='*=';function uniqueReduce(fn,nodes){return(0,_uniq2['default'])(nodes.reduce(fn,[]));}function safelyGenerateTokens(selector){try{return parser.parse(selector);}catch(err){throw new Error('Failed to parse selector: '+String(selector));}}function matchAttributeSelector(node,token){var operator=token.operator,value=token.value,name=token.name;var nodeProps=(0,_Utils.propsOfNode)(node);var descriptor=Object.getOwnPropertyDescriptor(nodeProps,name);if(descriptor&&descriptor.get){return false;}var nodePropValue=nodeProps[name];if(typeof nodePropValue==='undefined'){return false;}if(token.type===ATTRIBUTE_PRESENCE){return(0,_has2['default'])(nodeProps,token.name);}if(typeof nodePropValue!=='string'||typeof value!=='string'){if(operator!==EXACT_ATTRIBUTE_OPERATOR){return false;}}switch(operator){case EXACT_ATTRIBUTE_OPERATOR:return(0,_objectIs2['default'])(nodePropValue,value);case WHITELIST_ATTRIBUTE_OPERATOR:return nodePropValue.split(' ').indexOf(value)!==-1;case HYPHENATED_ATTRIBUTE_OPERATOR:return nodePropValue===value||nodePropValue.startsWith(String(value)+'-');case PREFIX_ATTRIBUTE_OPERATOR:return value===''?false:nodePropValue.slice(0,value.length)===value;case SUFFIX_ATTRIBUTE_OPERATOR:return value===''?false:nodePropValue.slice(-value.length)===value;case SUBSTRING_ATTRIBUTE_OPERATOR:return value===''?false:nodePropValue.indexOf(value)!==-1;default:throw new Error('Enzyme::Selector: Unknown attribute selector operator "'+String(operator)+'"');}}function nodeMatchesToken(node,token){if(node===null||typeof node==='string'){return false;}switch(token.type){case CLASS_SELECTOR:return(0,_RSTTraversal.hasClassName)(node,token.name);case TYPE_SELECTOR:return(0,_Utils.nodeHasType)(node,token.name);case ID_SELECTOR:return(0,_RSTTraversal.nodeHasId)(node,token.name);case ATTRIBUTE_PRESENCE:return matchAttributeSelector(node,token);case ATTRIBUTE_VALUE:return matchAttributeSelector(node,token);case PSEUDO_ELEMENT:case PSEUDO_CLASS:throw new Error('Enzyme::Selector does not support pseudo-element or pseudo-class selectors.');default:throw new Error('Unknown token type: '+String(token.type));}}function buildPredicateFromToken(token){return function(node){return token.body.every(function(bodyToken){return nodeMatchesToken(node,bodyToken);});};}function isComplexSelector(tokens){return tokens.some(function(token){return token.type!==SELECTOR;});}function buildPredicate(selector){if(typeof selector==='function'){return function(node){return node&&node.type===selector;};}if((typeof selector==='undefined'?'undefined':_typeof(selector))==='object'){if(!Array.isArray(selector)&&selector!==null&&!(0,_isEmpty2['default'])(selector)){var hasUndefinedValues=(0,_object2['default'])(selector).some(function(value){return typeof value==='undefined';});if(hasUndefinedValues){throw new TypeError('Enzyme::Props can’t have `undefined` values. Try using ‘findWhere()’ instead.');}return function(node){return(0,_RSTTraversal.nodeMatchesObjectProps)(node,selector);};}throw new TypeError('Enzyme::Selector does not support an array, null, or empty object as a selector');}if(typeof selector==='string'){var tokens=safelyGenerateTokens(selector);if(isComplexSelector(tokens)){throw new TypeError('This method does not support complex CSS selectors');}return buildPredicateFromToken(tokens[0]);}throw new TypeError('Enzyme::Selector expects a string, object, or Component Constructor');}function matchAdjacentSiblings(nodes,predicate,root){return nodes.reduce(function(matches,node){var parent=(0,_RSTTraversal.findParentNode)(root,node);if(!parent){return matches;}var nodeIndex=parent.rendered.indexOf(node);var adjacentSibling=parent.rendered[nodeIndex+1];if(!adjacentSibling){return matches;}if(predicate(adjacentSibling)){matches.push(adjacentSibling);}return matches;},[]);}function matchGeneralSibling(nodes,predicate,root){return uniqueReduce(function(matches,node){var parent=(0,_RSTTraversal.findParentNode)(root,node);var nodeIndex=parent.rendered.indexOf(node);parent.rendered.forEach(function(sibling,i){if(i>nodeIndex&&predicate(sibling)){matches.push(sibling);}});return matches;},nodes);}function matchDirectChild(nodes,predicate){return uniqueReduce(function(matches,node){var children=(0,_RSTTraversal.childrenOfNode)(node);children.forEach(function(child){if(predicate(child)){matches.push(child);}});return matches;},nodes);}function matchDescendant(nodes,predicate){return uniqueReduce(function(matches,node){return matches.concat((0,_RSTTraversal.treeFilter)(node,predicate));},nodes);}function reduceTreeBySelector(selector,root){var results=[];if(typeof selector==='function'||(typeof selector==='undefined'?'undefined':_typeof(selector))==='object'){results=(0,_RSTTraversal.treeFilter)(root,buildPredicate(selector));}else if(typeof selector==='string'){var tokens=safelyGenerateTokens(selector);var index=0;var token=null;while(index<tokens.length){token=tokens[index];if(token.type===SELECTOR){var predicate=buildPredicateFromToken(token);results=results.concat((0,_RSTTraversal.treeFilter)(root,predicate));}else{var _token=token,type=_token.type;index+=1;token=tokens[index];var _predicate=buildPredicateFromToken(token);switch(type){case ADJACENT_SIBLING:results=matchAdjacentSiblings(results,_predicate,root);break;case GENERAL_SIBLING:results=matchGeneralSibling(results,_predicate,root);break;case CHILD:results=matchDirectChild(results,_predicate);break;case DESCENDANT:{results=matchDescendant(results,_predicate);break;}default:throw new Error('Unkown combinator selector: '+String(type));}}index+=1;}}else{throw new TypeError('Enzyme::Selector expects a string, object, or Component Constructor');}return results;}function reduceTreesBySelector(selector,roots){var results=roots.map(function(n){return reduceTreeBySelector(selector,n);});return(0,_uniq2['default'])((0,_flatten2['default'])(results));}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdG9ycy5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIl90eXBlb2YiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm9iaiIsImNvbnN0cnVjdG9yIiwicHJvdG90eXBlIiwiYnVpbGRQcmVkaWNhdGUiLCJyZWR1Y2VUcmVlQnlTZWxlY3RvciIsInJlZHVjZVRyZWVzQnlTZWxlY3RvciIsIl9yc3RTZWxlY3RvclBhcnNlciIsInJlcXVpcmUiLCJfb2JqZWN0IiwiX29iamVjdDIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2lzRW1wdHkiLCJfaXNFbXB0eTIiLCJfZmxhdHRlbiIsIl9mbGF0dGVuMiIsIl91bmlxIiwiX3VuaXEyIiwiX29iamVjdElzIiwiX29iamVjdElzMiIsIl9oYXMiLCJfaGFzMiIsIl9SU1RUcmF2ZXJzYWwiLCJfVXRpbHMiLCJfX2VzTW9kdWxlIiwicGFyc2VyIiwiY3JlYXRlUGFyc2VyIiwiQ0hJTEQiLCJBREpBQ0VOVF9TSUJMSU5HIiwiR0VORVJBTF9TSUJMSU5HIiwiREVTQ0VOREFOVCIsIlNFTEVDVE9SIiwiVFlQRV9TRUxFQ1RPUiIsIkNMQVNTX1NFTEVDVE9SIiwiSURfU0VMRUNUT1IiLCJBVFRSSUJVVEVfUFJFU0VOQ0UiLCJBVFRSSUJVVEVfVkFMVUUiLCJQU0VVRE9fQ0xBU1MiLCJQU0VVRE9fRUxFTUVOVCIsIkVYQUNUX0FUVFJJQlVURV9PUEVSQVRPUiIsIldISVRFTElTVF9BVFRSSUJVVEVfT1BFUkFUT1IiLCJIWVBIRU5BVEVEX0FUVFJJQlVURV9PUEVSQVRPUiIsIlBSRUZJWF9BVFRSSUJVVEVfT1BFUkFUT1IiLCJTVUZGSVhfQVRUUklCVVRFX09QRVJBVE9SIiwiU1VCU1RSSU5HX0FUVFJJQlVURV9PUEVSQVRPUiIsInVuaXF1ZVJlZHVjZSIsImZuIiwibm9kZXMiLCJyZWR1Y2UiLCJzYWZlbHlHZW5lcmF0ZVRva2VucyIsInNlbGVjdG9yIiwicGFyc2UiLCJlcnIiLCJFcnJvciIsIlN0cmluZyIsIm1hdGNoQXR0cmlidXRlU2VsZWN0b3IiLCJub2RlIiwidG9rZW4iLCJvcGVyYXRvciIsIm5hbWUiLCJub2RlUHJvcHMiLCJwcm9wc09mTm9kZSIsImRlc2NyaXB0b3IiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJub2RlUHJvcFZhbHVlIiwidHlwZSIsInNwbGl0IiwiaW5kZXhPZiIsInN0YXJ0c1dpdGgiLCJzbGljZSIsImxlbmd0aCIsIm5vZGVNYXRjaGVzVG9rZW4iLCJoYXNDbGFzc05hbWUiLCJub2RlSGFzVHlwZSIsIm5vZGVIYXNJZCIsImJ1aWxkUHJlZGljYXRlRnJvbVRva2VuIiwiYm9keSIsImV2ZXJ5IiwiYm9keVRva2VuIiwiaXNDb21wbGV4U2VsZWN0b3IiLCJ0b2tlbnMiLCJzb21lIiwiQXJyYXkiLCJpc0FycmF5IiwiaGFzVW5kZWZpbmVkVmFsdWVzIiwiVHlwZUVycm9yIiwibm9kZU1hdGNoZXNPYmplY3RQcm9wcyIsIm1hdGNoQWRqYWNlbnRTaWJsaW5ncyIsInByZWRpY2F0ZSIsInJvb3QiLCJtYXRjaGVzIiwicGFyZW50IiwiZmluZFBhcmVudE5vZGUiLCJub2RlSW5kZXgiLCJyZW5kZXJlZCIsImFkamFjZW50U2libGluZyIsInB1c2giLCJtYXRjaEdlbmVyYWxTaWJsaW5nIiwiZm9yRWFjaCIsInNpYmxpbmciLCJpIiwibWF0Y2hEaXJlY3RDaGlsZCIsImNoaWxkcmVuIiwiY2hpbGRyZW5PZk5vZGUiLCJjaGlsZCIsIm1hdGNoRGVzY2VuZGFudCIsImNvbmNhdCIsInRyZWVGaWx0ZXIiLCJyZXN1bHRzIiwiaW5kZXgiLCJfdG9rZW4iLCJfcHJlZGljYXRlIiwicm9vdHMiLCJtYXAiLCJuIl0sIm1hcHBpbmdzIjoiQUFBQUEsT0FBT0MsY0FBUCxDQUFzQkMsT0FBdEIsQ0FBK0IsWUFBL0IsQ0FBNkMsQ0FDM0NDLE1BQU8sSUFEb0MsQ0FBN0MsRUFJQSxHQUFJQyxTQUFVLE1BQU9DLE9BQVAsR0FBa0IsVUFB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QyxDQUFWLENBQWEsQ0FDbkMsTUFBTzlHLHNCQUFxQjZDLFFBQXJCLENBQStCaUUsQ0FBL0IsQ0FBUCxDQUNELENBRmEsQ0FBZCxDQUdBLE1BQU8sQ0FBQyxFQUFHbEcsT0FBTyxTQUFQLENBQUosRUFBdUIsQ0FBQyxFQUFHRixVQUFVLFNBQVYsQ0FBSixFQUEwQjhGLE9BQTFCLENBQXZCLENBQVAsQ0FDRCIsImZpbGUiOiJzZWxlY3RvcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbmV4cG9ydHMuYnVpbGRQcmVkaWNhdGUgPSBidWlsZFByZWRpY2F0ZTtcbmV4cG9ydHMucmVkdWNlVHJlZUJ5U2VsZWN0b3IgPSByZWR1Y2VUcmVlQnlTZWxlY3RvcjtcbmV4cG9ydHMucmVkdWNlVHJlZXNCeVNlbGVjdG9yID0gcmVkdWNlVHJlZXNCeVNlbGVjdG9yO1xuXG52YXIgX3JzdFNlbGVjdG9yUGFyc2VyID0gcmVxdWlyZSgncnN0LXNlbGVjdG9yLXBhcnNlcicpO1xuXG52YXIgX29iamVjdCA9IHJlcXVpcmUoJ29iamVjdC52YWx1ZXMnKTtcblxudmFyIF9vYmplY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfb2JqZWN0KTtcblxudmFyIF9pc0VtcHR5ID0gcmVxdWlyZSgnbG9kYXNoL2lzRW1wdHknKTtcblxudmFyIF9pc0VtcHR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lzRW1wdHkpO1xuXG52YXIgX2ZsYXR0ZW4gPSByZXF1aXJlKCdsb2Rhc2gvZmxhdHRlbicpO1xuXG52YXIgX2ZsYXR0ZW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZmxhdHRlbik7XG5cbnZhciBfdW5pcSA9IHJlcXVpcmUoJ2xvZGFzaC91bmlxJyk7XG5cbnZhciBfdW5pcTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91bmlxKTtcblxudmFyIF9vYmplY3RJcyA9IHJlcXVpcmUoJ29iamVjdC1pcycpO1xuXG52YXIgX29iamVjdElzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX29iamVjdElzKTtcblxudmFyIF9oYXMgPSByZXF1aXJlKCdoYXMnKTtcblxudmFyIF9oYXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGFzKTtcblxudmFyIF9SU1RUcmF2ZXJzYWwgPSByZXF1aXJlKCcuL1JTVFRyYXZlcnNhbCcpO1xuXG52YXIgX1V0aWxzID0gcmVxdWlyZSgnLi9VdGlscycpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbi8vIG91ciBDU1Mgc2VsZWN0b3IgcGFyc2VyIGluc3RhbmNlXG52YXIgcGFyc2VyID0gKDAsIF9yc3RTZWxlY3RvclBhcnNlci5jcmVhdGVQYXJzZXIpKCk7XG5cbi8vIENvbWJpbmF0b3JzIHRoYXQgYWxsb3cgeW91IHRvIGNoYW5jZSBzZWxlY3RvcnNcbnZhciBDSElMRCA9ICdjaGlsZENvbWJpbmF0b3InO1xudmFyIEFESkFDRU5UX1NJQkxJTkcgPSAnYWRqYWNlbnRTaWJsaW5nQ29tYmluYXRvcic7XG52YXIgR0VORVJBTF9TSUJMSU5HID0gJ2dlbmVyYWxTaWJsaW5nQ29tYmluYXRvcic7XG52YXIgREVTQ0VOREFOVCA9ICdkZXNjZW5kYW50Q29tYmluYXRvcic7XG5cbi8vIFNlbGVjdG9ycyBmb3IgdGFyZ2V0aW5nIGVsZW1lbnRzXG52YXIgU0VMRUNUT1IgPSAnc2VsZWN0b3InO1xudmFyIFRZUEVfU0VMRUNUT1IgPSAndHlwZVNlbGVjdG9yJztcbnZhciBDTEFTU19TRUxFQ1RPUiA9ICdjbGFzc1NlbGVjdG9yJztcbnZhciBJRF9TRUxFQ1RPUiA9ICdpZFNlbGVjdG9yJztcbnZhciBBVFRSSUJVVEVfUFJFU0VOQ0UgPSAnYXR0cmlidXRlUHJlc2VuY2VTZWxlY3Rvcic7XG52YXIgQVRUUklCVVRFX1ZBTFVFID0gJ2F0dHJpYnV0ZVZhbHVlU2VsZWN0b3InO1xuLy8gQFRPRE8gd2UgZG9udCBzdXBwb3J0IHRoZXNlLCB0aHJvdyBpZiB0aGV5IGFyZSB1c2VkXG52YXIgUFNFVURPX0NMQVNTID0gJ3BzZXVkb0NsYXNzU2VsZWN0b3InO1xudmFyIFBTRVVET19FTEVNRU5UID0gJ3BzZXVkb0VsZW1lbnRTZWxlY3Rvcic7XG5cbnZhciBFWEFDVF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnPSc7XG52YXIgV0hJVEVMSVNUX0FUVFJJQlVURV9PUEVSQVRPUiA9ICd+PSc7XG52YXIgSFlQSEVOQVRFRF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnfD0nO1xudmFyIFBSRUZJWF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnXj0nO1xudmFyIFNVRkZJWF9BVFRSSUJVVEVfT1BFUkFUT1IgPSAnJD0nO1xudmFyIFNVQlNUUklOR19BVFRSSUJVVEVfT1BFUkFUT1IgPSAnKj0nO1xuXG4vKipcbiAqIENhbGxzIHJlZHVjZSBvbiBhIGFycmF5IG9mIG5vZGVzIHdpdGggdGhlIHBhc3NlZFxuICogZnVuY3Rpb24sIHJldHVybmluZyBvbmx5IHVuaXF1ZSByZXN1bHRzLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cbiAqIEBwYXJhbSB7QXJyYXk8Tm9kZT59IG5vZGVzXG4gKi9cbmZ1bmN0aW9uIHVuaXF1ZVJlZHVjZShmbiwgbm9kZXMpIHtcbiAgcmV0dXJuICgwLCBfdW5pcTJbJ2RlZmF1bHQnXSkobm9kZXMucmVkdWNlKGZuLCBbXSkpO1xufVxuXG4vKipcbiAqIFRha2VzIGEgQ1NTIHNlbGVjdG9yIGFuZCByZXR1cm5zIGEgc2V0IG9mIHRva2VucyBwYXJzZWRcbiAqIGJ5IHNjYWxwZWwuXG4gKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3JcbiAqL1xuZnVuY3Rpb24gc2FmZWx5R2VuZXJhdGVUb2tlbnMoc2VsZWN0b3IpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gcGFyc2VyLnBhcnNlKHNlbGVjdG9yKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGFyc2Ugc2VsZWN0b3I6ICcgKyBTdHJpbmcoc2VsZWN0b3IpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBtYXRjaEF0dHJpYnV0ZVNlbGVjdG9yKG5vZGUsIHRva2VuKSB7XG4gIHZhciBvcGVyYXRvciA9IHRva2VuLm9wZXJhdG9yLFxuICAgICAgdmFsdWUgPSB0b2tlbi52YWx1ZSxcbiAgICAgIG5hbWUgPSB0b2tlbi5uYW1lO1xuXG4gIHZhciBub2RlUHJvcHMgPSAoMCwgX1V0aWxzLnByb3BzT2ZOb2RlKShub2RlKTtcbiAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG5vZGVQcm9wcywgbmFtZSk7XG4gIGlmIChkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZ2V0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhciBub2RlUHJvcFZhbHVlID0gbm9kZVByb3BzW25hbWVdO1xuICBpZiAodHlwZW9mIG5vZGVQcm9wVmFsdWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmICh0b2tlbi50eXBlID09PSBBVFRSSUJVVEVfUFJFU0VOQ0UpIHtcbiAgICByZXR1cm4gKDAsIF9oYXMyWydkZWZhdWx0J10pKG5vZGVQcm9wcywgdG9rZW4ubmFtZSk7XG4gIH1cbiAgLy8gT25seSB0aGUgZXhhY3QgdmFsdWUgb3BlcmF0b3IgKFwiPVwiKSBjYW4gbWF0Y2ggbm9uLXN0cmluZ3NcbiAgaWYgKHR5cGVvZiBub2RlUHJvcFZhbHVlICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKG9wZXJhdG9yICE9PSBFWEFDVF9BVFRSSUJVVEVfT1BFUkFUT1IpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgIC8qKlxuICAgICAqIFJlcHJlc2VudHMgYW4gZWxlbWVudCB3aXRoIHRoZSBhdHQgYXR0cmlidXRlIHdob3NlIHZhbHVlIGlzIGV4YWN0bHkgXCJ2YWxcIi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIFthdHRyPVwidmFsXCJdIG1hdGNoZXMgYXR0cj1cInZhbFwiXG4gICAgICovXG4gICAgY2FzZSBFWEFDVF9BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gKDAsIF9vYmplY3RJczJbJ2RlZmF1bHQnXSkobm9kZVByb3BWYWx1ZSwgdmFsdWUpO1xuICAgIC8qKlxuICAgICAqIFJlcHJlc2VudHMgYW4gZWxlbWVudCB3aXRoIHRoZSBhdHQgYXR0cmlidXRlIHdob3NlIHZhbHVlIGlzIGEgd2hpdGVzcGFjZS1zZXBhcmF0ZWRcbiAgICAgKiBsaXN0IG9mIHdvcmRzLCBvbmUgb2Ygd2hpY2ggaXMgZXhhY3RseVxuICAgICAqIEBleGFtcGxlXG4gICAgICogIFtyZWx+PVwiY29weXJpZ2h0XCJdIG1hdGNoZXMgcmVsPVwiY29weXJpZ2h0IG90aGVyXCJcbiAgICAgKi9cbiAgICBjYXNlIFdISVRFTElTVF9BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gbm9kZVByb3BWYWx1ZS5zcGxpdCgnICcpLmluZGV4T2YodmFsdWUpICE9PSAtMTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSwgaXRzIHZhbHVlIGVpdGhlciBiZWluZyBleGFjdGx5IHRoZVxuICAgICAqIHZhbHVlIG9yIGJlZ2lubmluZyB3aXRoIHRoZSB2YWx1ZSBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSBcIi1cIlxuICAgICAqIEBleGFtcGxlXG4gICAgICogW2hyZWZsYW5nfD1cImVuXCJdIG1hdGNoZXMgaHJlZmxhbmc9XCJlbi1VU1wiXG4gICAgICovXG4gICAgY2FzZSBIWVBIRU5BVEVEX0FUVFJJQlVURV9PUEVSQVRPUjpcbiAgICAgIHJldHVybiBub2RlUHJvcFZhbHVlID09PSB2YWx1ZSB8fCBub2RlUHJvcFZhbHVlLnN0YXJ0c1dpdGgoU3RyaW5nKHZhbHVlKSArICctJyk7XG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhbiBlbGVtZW50IHdpdGggdGhlIGF0dCBhdHRyaWJ1dGUgd2hvc2UgdmFsdWUgYmVnaW5zIHdpdGggdGhlIHByZWZpeCB2YWx1ZS5cbiAgICAgKiBJZiB0aGUgdmFsdWUgaXMgdGhlIGVtcHR5IHN0cmluZyB0aGVuIHRoZSBzZWxlY3RvciBkb2VzIG5vdCByZXByZXNlbnQgYW55dGhpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBbdHlwZV49XCJpbWFnZVwiXSBtYXRjaGVzIHR5cGU9XCJpbWFnZW9iamVjdFwiXG4gICAgICovXG4gICAgY2FzZSBQUkVGSVhfQVRUUklCVVRFX09QRVJBVE9SOlxuICAgICAgcmV0dXJuIHZhbHVlID09PSAnJyA/IGZhbHNlIDogbm9kZVByb3BWYWx1ZS5zbGljZSgwLCB2YWx1ZS5sZW5ndGgpID09PSB2YWx1ZTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0IGF0dHJpYnV0ZSB3aG9zZSB2YWx1ZSBlbmRzIHdpdGggdGhlIHN1ZmZpeCB2YWx1ZS5cbiAgICAgKiBJZiB0aGUgdmFsdWUgaXMgdGhlIGVtcHR5IHN0cmluZyB0aGVuIHRoZSBzZWxlY3RvciBkb2VzIG5vdCByZXByZXNlbnQgYW55dGhpbmcuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBbdHlwZSQ9XCJpbWFnZVwiXSBtYXRjaGVzIHR5cGU9XCJpbWFnZW9iamVjdFwiXG4gICAgICovXG4gICAgY2FzZSBTVUZGSVhfQVRUUklCVVRFX09QRVJBVE9SOlxuICAgICAgcmV0dXJuIHZhbHVlID09PSAnJyA/IGZhbHNlIDogbm9kZVByb3BWYWx1ZS5zbGljZSgtdmFsdWUubGVuZ3RoKSA9PT0gdmFsdWU7XG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhbiBlbGVtZW50IHdpdGggdGhlIGF0dCBhdHRyaWJ1dGUgd2hvc2UgdmFsdWUgY29udGFpbnMgYXQgbGVhc3Qgb25lXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIHZhbHVlLiBJZiB2YWx1ZSBpcyB0aGUgZW1wdHkgc3RyaW5nIHRoZW4gdGhlXG4gICAgICogc2VsZWN0b3IgZG9lcyBub3QgcmVwcmVzZW50IGFueXRoaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogW3RpdGxlKj1cImhlbGxvXCJdIG1hdGNoZXMgdGl0bGU9XCJ3ZWxsIGhlbGxvIHRoZXJlXCJcbiAgICAgKi9cbiAgICBjYXNlIFNVQlNUUklOR19BVFRSSUJVVEVfT1BFUkFUT1I6XG4gICAgICByZXR1cm4gdmFsdWUgPT09ICcnID8gZmFsc2UgOiBub2RlUHJvcFZhbHVlLmluZGV4T2YodmFsdWUpICE9PSAtMTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbnp5bWU6OlNlbGVjdG9yOiBVbmtub3duIGF0dHJpYnV0ZSBzZWxlY3RvciBvcGVyYXRvciBcIicgKyBTdHJpbmcob3BlcmF0b3IpICsgJ1wiJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBUYWtlcyBhIG5vZGUgYW5kIGEgdG9rZW4gYW5kIGRldGVybWluZXMgaWYgdGhlIG5vZGVcbiAqIG1hdGNoZXMgdGhlIHByZWRpY2F0ZSBkZWZpbmVkIGJ5IHRoZSB0b2tlbi5cbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHtUb2tlbn0gdG9rZW5cbiAqL1xuZnVuY3Rpb24gbm9kZU1hdGNoZXNUb2tlbihub2RlLCB0b2tlbikge1xuICBpZiAobm9kZSA9PT0gbnVsbCB8fCB0eXBlb2Ygbm9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgc3dpdGNoICh0b2tlbi50eXBlKSB7XG4gICAgLyoqXG4gICAgICogTWF0Y2ggYWdhaW5zdCB0aGUgY2xhc3NOYW1lIHByb3BcbiAgICAgKiBAZXhhbXBsZSAnLmFjdGl2ZScgbWF0Y2hlcyA8ZGl2IGNsYXNzTmFtZT0nYWN0aXZlJyAvPlxuICAgICAqL1xuICAgIGNhc2UgQ0xBU1NfU0VMRUNUT1I6XG4gICAgICByZXR1cm4gKDAsIF9SU1RUcmF2ZXJzYWwuaGFzQ2xhc3NOYW1lKShub2RlLCB0b2tlbi5uYW1lKTtcbiAgICAvKipcbiAgICAgKiBTaW1wbGUgdHlwZSBtYXRjaGluZ1xuICAgICAqIEBleGFtcGxlICdkaXYnIG1hdGNoZXMgPGRpdiAvPlxuICAgICAqL1xuICAgIGNhc2UgVFlQRV9TRUxFQ1RPUjpcbiAgICAgIHJldHVybiAoMCwgX1V0aWxzLm5vZGVIYXNUeXBlKShub2RlLCB0b2tlbi5uYW1lKTtcbiAgICAvKipcbiAgICAgKiBNYXRjaCBhZ2FpbnN0IHRoZSBgaWRgIHByb3BcbiAgICAgKiBAZXhhbXBsZSAnI25hdicgbWF0Y2hlcyA8dWwgaWQ9XCJuYXZcIiAvPlxuICAgICAqL1xuICAgIGNhc2UgSURfU0VMRUNUT1I6XG4gICAgICByZXR1cm4gKDAsIF9SU1RUcmF2ZXJzYWwubm9kZUhhc0lkKShub2RlLCB0b2tlbi5uYW1lKTtcbiAgICAvKipcbiAgICAgKiBNYXRjaGVzIGlmIGFuIGF0dHJpYnV0ZSBpcyBwcmVzZW50LCByZWdhcmRsZXNzXG4gICAgICogb2YgaXRzIHZhbHVlXG4gICAgICogQGV4YW1wbGUgJ1tkaXNhYmxlZF0nIG1hdGNoZXMgPGEgZGlzYWJsZWQgLz5cbiAgICAgKi9cbiAgICBjYXNlIEFUVFJJQlVURV9QUkVTRU5DRTpcbiAgICAgIHJldHVybiBtYXRjaEF0dHJpYnV0ZVNlbGVjdG9yKG5vZGUsIHRva2VuKTtcbiAgICAvKipcbiAgICAgKiBNYXRjaGVzIGlmIGFuIGF0dHJpYnV0ZSBpcyBwcmVzZW50IHdpdGggdGhlXG4gICAgICogcHJvdmlkZWQgdmFsdWVcbiAgICAgKiBAZXhhbXBsZSAnW2RhdGEtZm9vPWZvb10nIG1hdGNoZXMgPGRpdiBkYXRhLWZvbz1cImZvb1wiIC8+XG4gICAgICovXG4gICAgY2FzZSBBVFRSSUJVVEVfVkFMVUU6XG4gICAgICByZXR1cm4gbWF0Y2hBdHRyaWJ1dGVTZWxlY3Rvcihub2RlLCB0b2tlbik7XG4gICAgY2FzZSBQU0VVRE9fRUxFTUVOVDpcbiAgICBjYXNlIFBTRVVET19DTEFTUzpcbiAgICAgIHRocm93IG5ldyBFcnJvcignRW56eW1lOjpTZWxlY3RvciBkb2VzIG5vdCBzdXBwb3J0IHBzZXVkby1lbGVtZW50IG9yIHBzZXVkby1jbGFzcyBzZWxlY3RvcnMuJyk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biB0b2tlbiB0eXBlOiAnICsgU3RyaW5nKHRva2VuLnR5cGUpKTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBwcmVkaWNhdGUgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgYVxuICogbm9kZSBtYXRjaGVzIGV2ZXJ5IHRva2VuIGluIHRoZSBib2R5IG9mIGEgc2VsZWN0b3JcbiAqIHRva2VuLlxuICogQHBhcmFtIHtUb2tlbn0gdG9rZW5cbiAqL1xuZnVuY3Rpb24gYnVpbGRQcmVkaWNhdGVGcm9tVG9rZW4odG9rZW4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIHRva2VuLmJvZHkuZXZlcnkoZnVuY3Rpb24gKGJvZHlUb2tlbikge1xuICAgICAgcmV0dXJuIG5vZGVNYXRjaGVzVG9rZW4obm9kZSwgYm9keVRva2VuKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgYSBwYXJzZWQgc2VsZWN0b3IgaXMgYSBjb21wbGV4IHNlbGVjdG9yLCB3aGljaFxuICogaXMgZGVmaW5lZCBhcyBhIHNlbGVjdG9yIHRoYXQgY29udGFpbnMgY29tYmluYXRvcnMuXG4gKiBAcGFyYW0ge0FycmF5PFRva2VuPn0gdG9rZW5zXG4gKi9cbmZ1bmN0aW9uIGlzQ29tcGxleFNlbGVjdG9yKHRva2Vucykge1xuICByZXR1cm4gdG9rZW5zLnNvbWUoZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgcmV0dXJuIHRva2VuLnR5cGUgIT09IFNFTEVDVE9SO1xuICB9KTtcbn1cblxuLyoqXG4gKiBUYWtlcyBhIGNvbXBvbmVudCBjb25zdHJ1Y3Rvciwgb2JqZWN0LCBvciBzdHJpbmcgcmVwcmVzZW50aW5nXG4gKiBhIHNpbXBsZSBzZWxlY3RvciBhbmQgcmV0dXJucyBhIHByZWRpY2F0ZSBmdW5jdGlvbiB0aGF0IGNhblxuICogYmUgYXBwbGllZCB0byBhIHNpbmdsZSBub2RlLlxuICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R8U3RyaW5nfSBzZWxlY3RvclxuICovXG5mdW5jdGlvbiBidWlsZFByZWRpY2F0ZShzZWxlY3Rvcikge1xuICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgYSBmdW5jdGlvbiwgY2hlY2sgaWYgdGhlIG5vZGUncyBjb25zdHJ1Y3RvciBtYXRjaGVzXG4gIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHJldHVybiBub2RlICYmIG5vZGUudHlwZSA9PT0gc2VsZWN0b3I7XG4gICAgfTtcbiAgfVxuICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgYW4gbm9uLWVtcHR5IG9iamVjdCwgdHJlYXQgdGhlIGtleXMvdmFsdWVzIGFzIHByb3BzXG4gIGlmICgodHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihzZWxlY3RvcikpID09PSAnb2JqZWN0Jykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShzZWxlY3RvcikgJiYgc2VsZWN0b3IgIT09IG51bGwgJiYgISgwLCBfaXNFbXB0eTJbJ2RlZmF1bHQnXSkoc2VsZWN0b3IpKSB7XG4gICAgICB2YXIgaGFzVW5kZWZpbmVkVmFsdWVzID0gKDAsIF9vYmplY3QyWydkZWZhdWx0J10pKHNlbGVjdG9yKS5zb21lKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJztcbiAgICAgIH0pO1xuICAgICAgaWYgKGhhc1VuZGVmaW5lZFZhbHVlcykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFbnp5bWU6OlByb3BzIGNhbuKAmXQgaGF2ZSBgdW5kZWZpbmVkYCB2YWx1ZXMuIFRyeSB1c2luZyDigJhmaW5kV2hlcmUoKeKAmSBpbnN0ZWFkLicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiAoMCwgX1JTVFRyYXZlcnNhbC5ub2RlTWF0Y2hlc09iamVjdFByb3BzKShub2RlLCBzZWxlY3Rvcik7XG4gICAgICB9O1xuICAgIH1cbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFbnp5bWU6OlNlbGVjdG9yIGRvZXMgbm90IHN1cHBvcnQgYW4gYXJyYXksIG51bGwsIG9yIGVtcHR5IG9iamVjdCBhcyBhIHNlbGVjdG9yJyk7XG4gIH1cbiAgLy8gSWYgdGhlIHNlbGVjdG9yIGlzIGEgc3RyaW5nLCBwYXJzZSBpdCBhcyBhIHNpbXBsZSBDU1Mgc2VsZWN0b3JcbiAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICB2YXIgdG9rZW5zID0gc2FmZWx5R2VuZXJhdGVUb2tlbnMoc2VsZWN0b3IpO1xuICAgIGlmIChpc0NvbXBsZXhTZWxlY3Rvcih0b2tlbnMpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IGNvbXBsZXggQ1NTIHNlbGVjdG9ycycpO1xuICAgIH1cbiAgICAvLyBTaW1wbGUgc2VsZWN0b3JzIG9ubHkgaGF2ZSBhIHNpbmdsZSBzZWxlY3RvciB0b2tlblxuICAgIHJldHVybiBidWlsZFByZWRpY2F0ZUZyb21Ub2tlbih0b2tlbnNbMF0pO1xuICB9XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoJ0VuenltZTo6U2VsZWN0b3IgZXhwZWN0cyBhIHN0cmluZywgb2JqZWN0LCBvciBDb21wb25lbnQgQ29uc3RydWN0b3InKTtcbn1cblxuLyoqXG4gKiBNYXRjaGVzIG9ubHkgbm9kZXMgd2hpY2ggYXJlIGFkamFjZW50IHNpYmxpbmdzIChkaXJlY3QgbmV4dCBzaWJsaW5nKVxuICogYWdhaW5zdCBhIHByZWRpY2F0ZSwgcmV0dXJuaW5nIHRob3NlIHRoYXQgbWF0Y2guXG4gKiBAcGFyYW0ge0FycmF5PE5vZGU+fSBub2Rlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG4gKiBAcGFyYW0ge05vZGV9IHJvb3RcbiAqL1xuZnVuY3Rpb24gbWF0Y2hBZGphY2VudFNpYmxpbmdzKG5vZGVzLCBwcmVkaWNhdGUsIHJvb3QpIHtcbiAgcmV0dXJuIG5vZGVzLnJlZHVjZShmdW5jdGlvbiAobWF0Y2hlcywgbm9kZSkge1xuICAgIHZhciBwYXJlbnQgPSAoMCwgX1JTVFRyYXZlcnNhbC5maW5kUGFyZW50Tm9kZSkocm9vdCwgbm9kZSk7XG4gICAgLy8gSWYgdGhlcmUncyBubyBwYXJlbnQsIHRoZXJlJ3Mgbm8gc2libGluZ3NcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICAgIHZhciBub2RlSW5kZXggPSBwYXJlbnQucmVuZGVyZWQuaW5kZXhPZihub2RlKTtcbiAgICB2YXIgYWRqYWNlbnRTaWJsaW5nID0gcGFyZW50LnJlbmRlcmVkW25vZGVJbmRleCArIDFdO1xuICAgIC8vIE5vIHNpYmxpbmdcbiAgICBpZiAoIWFkamFjZW50U2libGluZykge1xuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICAgIGlmIChwcmVkaWNhdGUoYWRqYWNlbnRTaWJsaW5nKSkge1xuICAgICAgbWF0Y2hlcy5wdXNoKGFkamFjZW50U2libGluZyk7XG4gICAgfVxuICAgIHJldHVybiBtYXRjaGVzO1xuICB9LCBbXSk7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBvbmx5IG5vZGVzIHdoaWNoIGFyZSBnZW5lcmFsIHNpYmxpbmdzIChhbnkgc2libGluZyAqYWZ0ZXIqKVxuICogYWdhaW5zdCBhIHByZWRpY2F0ZSwgcmV0dXJuaW5nIHRob3NlIHRoYXQgbWF0Y2guXG4gKiBAcGFyYW0ge0FycmF5PE5vZGU+fSBub2Rlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG4gKiBAcGFyYW0ge05vZGV9IHJvb3RcbiAqL1xuZnVuY3Rpb24gbWF0Y2hHZW5lcmFsU2libGluZyhub2RlcywgcHJlZGljYXRlLCByb290KSB7XG4gIHJldHVybiB1bmlxdWVSZWR1Y2UoZnVuY3Rpb24gKG1hdGNoZXMsIG5vZGUpIHtcbiAgICB2YXIgcGFyZW50ID0gKDAsIF9SU1RUcmF2ZXJzYWwuZmluZFBhcmVudE5vZGUpKHJvb3QsIG5vZGUpO1xuICAgIHZhciBub2RlSW5kZXggPSBwYXJlbnQucmVuZGVyZWQuaW5kZXhPZihub2RlKTtcbiAgICBwYXJlbnQucmVuZGVyZWQuZm9yRWFjaChmdW5jdGlvbiAoc2libGluZywgaSkge1xuICAgICAgaWYgKGkgPiBub2RlSW5kZXggJiYgcHJlZGljYXRlKHNpYmxpbmcpKSB7XG4gICAgICAgIG1hdGNoZXMucHVzaChzaWJsaW5nKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWF0Y2hlcztcbiAgfSwgbm9kZXMpO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgb25seSBub2RlcyB3aGljaCBhcmUgZGlyZWN0IGNoaWxkcmVuIChub3QgZ3JhbmRjaGlsZHJlbiwgZXRjLilcbiAqIGFnYWluc3QgYSBwcmVkaWNhdGUsIHJldHVybmluZyB0aG9zZSB0aGF0IG1hdGNoLlxuICogQHBhcmFtIHtBcnJheTxOb2RlPn0gbm9kZXNcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZVxuICovXG5mdW5jdGlvbiBtYXRjaERpcmVjdENoaWxkKG5vZGVzLCBwcmVkaWNhdGUpIHtcbiAgcmV0dXJuIHVuaXF1ZVJlZHVjZShmdW5jdGlvbiAobWF0Y2hlcywgbm9kZSkge1xuICAgIHZhciBjaGlsZHJlbiA9ICgwLCBfUlNUVHJhdmVyc2FsLmNoaWxkcmVuT2ZOb2RlKShub2RlKTtcbiAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgaWYgKHByZWRpY2F0ZShjaGlsZCkpIHtcbiAgICAgICAgbWF0Y2hlcy5wdXNoKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWF0Y2hlcztcbiAgfSwgbm9kZXMpO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgYWxsIGRlc2NlbmRhbnQgbm9kZXMgYWdhaW5zdCBhIHByZWRpY2F0ZSxcbiAqIHJldHVybmluZyB0aG9zZSB0aGF0IG1hdGNoLlxuICogQHBhcmFtIHtBcnJheTxOb2RlPn0gbm9kZXNcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZVxuICovXG5mdW5jdGlvbiBtYXRjaERlc2NlbmRhbnQobm9kZXMsIHByZWRpY2F0ZSkge1xuICByZXR1cm4gdW5pcXVlUmVkdWNlKGZ1bmN0aW9uIChtYXRjaGVzLCBub2RlKSB7XG4gICAgcmV0dXJuIG1hdGNoZXMuY29uY2F0KCgwLCBfUlNUVHJhdmVyc2FsLnRyZWVGaWx0ZXIpKG5vZGUsIHByZWRpY2F0ZSkpO1xuICB9LCBub2Rlcyk7XG59XG5cbi8qKlxuICogVGFrZXMgYW4gUlNUIGFuZCByZWR1Y2VzIGl0IHRvIGEgc2V0IG9mIG5vZGVzIG1hdGNoaW5nXG4gKiB0aGUgc2VsZWN0b3IuIFRoZSBzZWxlY3RvciBjYW4gYmUgYSBzaW1wbGUgc2VsZWN0b3IsIHdoaWNoXG4gKiBpcyBoYW5kbGVkIGJ5IGBidWlsZFByZWRpY2F0ZWAsIG9yIGEgY29tcGxleCBDU1Mgc2VsZWN0b3Igd2hpY2hcbiAqIHJlZHVjZVRyZWVCeVNlbGVjdG9yIHBhcnNlcyBhbmQgcmVkdWNlcyB0aGUgdHJlZSBiYXNlZCBvbiB0aGUgY29tYmluYXRvcnMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdHxTdHJpbmd9IHNlbGVjdG9yXG4gKiBAcGFyYW0ge1JTVE5vZGV9IHdyYXBwZXJcbiAqL1xuZnVuY3Rpb24gcmVkdWNlVHJlZUJ5U2VsZWN0b3Ioc2VsZWN0b3IsIHJvb3QpIHtcbiAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnZnVuY3Rpb24nIHx8ICh0eXBlb2Ygc2VsZWN0b3IgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHNlbGVjdG9yKSkgPT09ICdvYmplY3QnKSB7XG4gICAgcmVzdWx0cyA9ICgwLCBfUlNUVHJhdmVyc2FsLnRyZWVGaWx0ZXIpKHJvb3QsIGJ1aWxkUHJlZGljYXRlKHNlbGVjdG9yKSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgIHZhciB0b2tlbnMgPSBzYWZlbHlHZW5lcmF0ZVRva2VucyhzZWxlY3Rvcik7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgdG9rZW4gPSBudWxsO1xuICAgIHdoaWxlIChpbmRleCA8IHRva2Vucy5sZW5ndGgpIHtcbiAgICAgIHRva2VuID0gdG9rZW5zW2luZGV4XTtcbiAgICAgIC8qKlxuICAgICAgICogVGhlcmUgYXJlIHR3byB0eXBlcyBvZiB0b2tlbnMgaW4gYSBDU1Mgc2VsZWN0b3I6XG4gICAgICAgKlxuICAgICAgICogMS4gU2VsZWN0b3IgdG9rZW5zLiBUaGVzZSB0YXJnZXQgbm9kZXMgZGlyZWN0bHksIGxpa2VcbiAgICAgICAqICAgIHR5cGUgb3IgYXR0cmlidXRlIHNlbGVjdG9ycy4gVGhlc2UgYXJlIGVhc3kgdG8gYXBwbHlcbiAgICAgICAqICAgIGJlY2F1c2Ugd2UgY2FuIHRyYXZzZXJzZSB0aGUgdHJlZSBhbmQgcmV0dXJuIG9ubHlcbiAgICAgICAqICAgIHRoZSBub2RlcyB0aGF0IG1hdGNoIHRoZSBwcmVkaWNhdGUuXG4gICAgICAgKlxuICAgICAgICogMi4gQ29tYmluYXRvciB0b2tlbnMuIFRoZXNlIHRva2VucyBjaGFpbiB0b2dldGhlclxuICAgICAgICogICAgc2VsZWN0b3Igbm9kZXMuIEZvciBleGFtcGxlID4gZm9yIGNoaWxkcmVuLCBvciArXG4gICAgICAgKiAgICBmb3IgYWRqZWNlbnQgc2libGluZ3MuIFRoZXNlIGFyZSBoYXJkZXIgdG8gbWF0Y2hcbiAgICAgICAqICAgIGFzIHdlIGhhdmUgdG8gdHJhY2sgd2hlcmUgaW4gdGhlIHRyZWUgd2UgYXJlXG4gICAgICAgKiAgICB0byBkZXRlcm1pbmUgaWYgYSBzZWxlY3RvciBub2RlIGFwcGxpZXMgb3Igbm90LlxuICAgICAgICovXG4gICAgICBpZiAodG9rZW4udHlwZSA9PT0gU0VMRUNUT1IpIHtcbiAgICAgICAgdmFyIHByZWRpY2F0ZSA9IGJ1aWxkUHJlZGljYXRlRnJvbVRva2VuKHRva2VuKTtcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KCgwLCBfUlNUVHJhdmVyc2FsLnRyZWVGaWx0ZXIpKHJvb3QsIHByZWRpY2F0ZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gV2UgY2FuIGFzc3VtZSB0aGVyZSBhbHdheXMgYWxsIHByZXZpb3VzbHkgbWF0Y2hlZCB0b2tlbnMgc2luY2Ugc2VsZWN0b3JzXG4gICAgICAgIC8vIGNhbm5vdCBzdGFydCB3aXRoIGNvbWJpbmF0b3JzLlxuICAgICAgICB2YXIgX3Rva2VuID0gdG9rZW4sXG4gICAgICAgICAgICB0eXBlID0gX3Rva2VuLnR5cGU7XG4gICAgICAgIC8vIFdlIGFzc3VtZSB0aGUgbmV4dCB0b2tlbiBpcyBhIHNlbGVjdG9yLCBzbyBtb3ZlIHRoZSBpbmRleFxuICAgICAgICAvLyBmb3J3YXJkIGFuZCBidWlsZCB0aGUgcHJlZGljYXRlLlxuXG4gICAgICAgIGluZGV4ICs9IDE7XG4gICAgICAgIHRva2VuID0gdG9rZW5zW2luZGV4XTtcbiAgICAgICAgdmFyIF9wcmVkaWNhdGUgPSBidWlsZFByZWRpY2F0ZUZyb21Ub2tlbih0b2tlbik7XG4gICAgICAgIC8vIFdlIG1hdGNoIGFnYWluc3Qgb25seSB0aGUgbm9kZXMgd2hpY2ggaGF2ZSBhbHJlYWR5IGJlZW4gbWF0Y2hlZCxcbiAgICAgICAgLy8gc2luY2UgYSBjb21iaW5hdG9yIGlzIG1lYW50IHRvIHJlZmluZSBhIHByZXZpb3VzIHNlbGVjdG9yLlxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAvLyBUaGUgKyBjb21iaW5hdG9yXG4gICAgICAgICAgY2FzZSBBREpBQ0VOVF9TSUJMSU5HOlxuICAgICAgICAgICAgcmVzdWx0cyA9IG1hdGNoQWRqYWNlbnRTaWJsaW5ncyhyZXN1bHRzLCBfcHJlZGljYXRlLCByb290KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIC8vIFRoZSB+IGNvbWJpbmF0b3JcbiAgICAgICAgICBjYXNlIEdFTkVSQUxfU0lCTElORzpcbiAgICAgICAgICAgIHJlc3VsdHMgPSBtYXRjaEdlbmVyYWxTaWJsaW5nKHJlc3VsdHMsIF9wcmVkaWNhdGUsIHJvb3QpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgLy8gVGhlID4gY29tYmluYXRvclxuICAgICAgICAgIGNhc2UgQ0hJTEQ6XG4gICAgICAgICAgICByZXN1bHRzID0gbWF0Y2hEaXJlY3RDaGlsZChyZXN1bHRzLCBfcHJlZGljYXRlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIC8vIFRoZSAnICcgKHdoaXRlc3BhY2UpIGNvbWJpbmF0b3JcbiAgICAgICAgICBjYXNlIERFU0NFTkRBTlQ6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJlc3VsdHMgPSBtYXRjaERlc2NlbmRhbnQocmVzdWx0cywgX3ByZWRpY2F0ZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua293biBjb21iaW5hdG9yIHNlbGVjdG9yOiAnICsgU3RyaW5nKHR5cGUpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaW5kZXggKz0gMTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRW56eW1lOjpTZWxlY3RvciBleHBlY3RzIGEgc3RyaW5nLCBvYmplY3QsIG9yIENvbXBvbmVudCBDb25zdHJ1Y3RvcicpO1xuICB9XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG5mdW5jdGlvbiByZWR1Y2VUcmVlc0J5U2VsZWN0b3Ioc2VsZWN0b3IsIHJvb3RzKSB7XG4gIHZhciByZXN1bHRzID0gcm9vdHMubWFwKGZ1bmN0aW9uIChuKSB7XG4gICAgcmV0dXJuIHJlZHVjZVRyZWVCeVNlbGVjdG9yKHNlbGVjdG9yLCBuKTtcbiAgfSk7XG4gIHJldHVybiAoMCwgX3VuaXEyWydkZWZhdWx0J10pKCgwLCBfZmxhdHRlbjJbJ2RlZmF1bHQnXSkocmVzdWx0cykpO1xufSJdfQ==